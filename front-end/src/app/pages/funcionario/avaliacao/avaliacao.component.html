<div class="loading-overlay" *ngIf="loading && !avaliacaoHeader">
  <mat-spinner diameter="50"></mat-spinner>
  <span>Carregando a prova...</span>
</div>


<div class="avaliacao-container fade-in" *ngIf="avaliacaoHeader && !loading">

  <mat-card class="prova-header-card mat-elevation-z4">
    <div class="header-info">
      <h1 class="prova-titulo">{{ avaliacaoHeader.titulo }}</h1>
      <p class="prova-descricao">{{ avaliacaoHeader.descricao }}</p>
      <div class="meta-info">
        <span><mat-icon>help_outline</mat-icon> {{ questoesView.length }} Questões</span>
        <span><mat-icon>replay</mat-icon> Tentativas restantes: {{ avaliacaoHeader.tentativasPermitidas }}</span>
      </div>
    </div>

    <div class="timer-box" [class.timer-critico]="timerCritico">
      <div class="timer-label">Tempo Restante</div>
      <div class="timer-value">
        <mat-icon>timer</mat-icon>
        {{ tempoFormatado }}
      </div>
    </div>
  </mat-card>


  <div class="questoes-list">

    <mat-card class="questao-card mat-elevation-z2" *ngFor="let q of questoesView; let i = index">

      <mat-card-header class="questao-header">
        <div mat-card-avatar class="questao-numero">{{ i + 1 }}</div>
        <mat-card-title class="questao-titulo-bar">
          <span>Questão {{ i + 1 }}</span>
          <span class="questao-peso">{{ q.peso | number:'1.1-1' }} pts</span>
        </mat-card-title>
      </mat-card-header>

      <mat-card-content class="questao-body">
        <p class="enunciado" [innerHTML]="q.enunciado"></p> <mat-divider class="divider-espaco"></mat-divider>

        <div [ngSwitch]="q.tipoQuestao" class="area-resposta">

          <div *ngSwitchCase="'OBJETIVA'">
            <mat-radio-group [(ngModel)]="q.respostaUsuario" class="radio-group-vertical">
              <mat-radio-button *ngFor="let opcao of q.opcoesProcessadas" [value]="opcao.chave" class="radio-opcao">
                <span class="opcao-chave">{{ opcao.chave }})</span>
                <span class="opcao-texto">{{ opcao.texto }}</span>
              </mat-radio-button>
            </mat-radio-group>
          </div>

          <div *ngSwitchCase="'DISSERTATIVA'">
            <mat-form-field appearance="outline" class="full-width-textarea">
              <mat-label>Sua resposta dissertativa</mat-label>
              <textarea matInput
                        [(ngModel)]="q.respostaUsuario"
                        rows="6"
                        placeholder="Digite sua resposta aqui..."></textarea>
            </mat-form-field>
          </div>

        </div>

      </mat-card-content>
    </mat-card>

  </div>


  <div class="action-footer mat-elevation-z8">
    <p class="footer-info" *ngIf="!enviando">
      Revise suas respostas antes de finalizar.
    </p>
    <button mat-raised-button
            color="primary"
            class="btn-finalizar"
            (click)="confirmarEnvio()"
            [disabled]="enviando || tempoRestanteSegundos <= 0">

      <span *ngIf="!enviando">
        <mat-icon>send</mat-icon> Finalizar Avaliação
      </span>

      <span *ngIf="enviando" class="flex-center-gap">
        <mat-spinner diameter="24" color="accent"></mat-spinner> Enviando...
      </span>
    </button>
  </div>

</div>