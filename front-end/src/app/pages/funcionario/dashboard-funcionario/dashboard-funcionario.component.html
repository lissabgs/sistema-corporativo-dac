<div class="main-container">
  <!-- Sidebar -->
  <mat-card class="sidebar">
    <div class="header">
      <span class="app-title">Sistema DAC E-learning</span>
      <mat-icon class="menu-icon">menu</mat-icon>
    </div>

    <div class="user-profile">
      <mat-icon class="profile-icon">account_circle</mat-icon>
      <!-- Nome/E-mail do usuário aqui -->
    </div>

    <!-- Menu de Navegação -->
    <mat-nav-list class="nav-list">
      
      <!-- Menu do Funcionário -->
      <a mat-list-item routerLink="/dashboard-funcionario" routerLinkActive="active-link">
        <mat-icon matListItemIcon>dashboard</mat-icon>
        <span matListItemTitle>Dashboard</span>
      </a>
      <a mat-list-item routerLink="/catalogo-cursos" routerLinkActive="active-link">
        <mat-icon matListItemIcon>school</mat-icon>
        <span matListItemTitle>Catálogo de Cursos</span>
      </a>

      <!-- Menu do Instrutor (Para navegação se for Instrutor/Admin) -->
      <!-- O roleGuard impede acesso se não for autorizado, mas o link aparece. -->
      <mat-divider style="margin: 10px 0;"></mat-divider>
      <a mat-list-item routerLink="/gerenciar-cursos" routerLinkActive="active-link">
        <mat-icon matListItemIcon>edit_note</mat-icon>
        <span matListItemTitle>Gerenciar Cursos</span>
      </a>
      
      <!-- Logout é empurrado para o final pelo CSS -->
      <a mat-list-item class="logout-link" (click)="logout()">
        <mat-icon matListItemIcon>logout</mat-icon>
        <span matListItemTitle>Logout</span>
      </a>
    </mat-nav-list>

  </mat-card>

  <!-- Conteúdo Principal -->
  <div class="content-area">
    
    <!-- Seção KPI (XP, Nível, Progresso) - Layout de 3 colunas -->
    <section class="grid header-grid">
      <mat-card class="card kpi">
        <div class="kpi-header">
          <mat-icon>bolt</mat-icon>
          <span>XP Atual</span>
        </div>
        <div class="kpi-value">{{ xpAtual | number }}</div>
        <mat-progress-bar mode="determinate" [value]="progressoNivel"></mat-progress-bar>
        <div class="kpi-foot">
          {{ xpAtual }} / {{ xpParaProximoNivel }} XP para nível {{ nivel + 1 }}
        </div>
      </mat-card>

      <mat-card class="card kpi">
        <div class="kpi-header">
          <mat-icon>military_tech</mat-icon>
          <span>Nível</span>
        </div>
        <div class="kpi-value">Lvl {{ nivel }}</div>
        <div class="kpi-foot">Próximo badge: <strong>{{ proximoBadge.nome }}</strong></div>
        <div class="badge-row">
          <mat-chip-set>
            <mat-chip color="primary" class="selected-chip">
              <mat-icon>emoji_events</mat-icon>
              {{ proximoBadge.nome }}
            </mat-chip>
            <mat-chip>{{ proximoBadge.requisitoXp }} XP</mat-chip>
          </mat-chip-set>
        </div>
      </mat-card>

      <mat-card class="card kpi">
        <div class="kpi-header">
          <mat-icon>percent</mat-icon>
          <span>Progresso</span>
        </div>
        <div class="kpi-value">{{ progressoNivel | number : '1.0-0' }}%</div>
        <mat-progress-bar mode="determinate" [value]="progressoNivel"></mat-progress-bar>
        <div class="kpi-foot">Rumo ao próximo nível!</div>
      </mat-card>
    </section>

    <!-- Cursos e Listas -->
    <section class="grid courses-grid">
      <mat-card class="card">
        <mat-card-title>Cursos em andamento</mat-card-title>
        <mat-divider></mat-divider>
        <mat-list>
          <mat-list-item *ngFor="let c of cursosEmAndamento">
            <mat-icon matListItemIcon>play_circle</mat-icon>
            <div matListItemTitle>{{ c.titulo }}</div>
            <div matListItemLine class="muted">{{ c.categoria }}</div>
            <div class="row-end">
              <span class="pct">{{ c.progresso }}%</span>
              <mat-progress-bar mode="determinate" [value]="c.progresso"></mat-progress-bar>
            </div>
          </mat-list-item>
        </mat-list>
        <button mat-stroked-button color="primary" class="w-full" (click)="continuarCurso()">Continuar</button>
      </mat-card>

      <mat-card class="card">
        <mat-card-title>Cursos concluídos</mat-card-title>
        <mat-divider></mat-divider>
        <mat-list>
          <mat-list-item *ngFor="let c of cursosConcluidos">
            <mat-icon color="primary" matListItemIcon>check_circle</mat-icon>
            <div matListItemTitle>{{ c.titulo }}</div>
            <div matListItemLine class="muted">{{ c.categoria }}</div>
            <button mat-button color="primary" (click)="baixarCertificado(c)">
              <mat-icon>workspace_premium</mat-icon>&nbsp;Certificado
            </button>
          </mat-list-item>
        </mat-list>
      </mat-card>

      <mat-card class="card">
        <mat-card-title>Cursos disponíveis</mat-card-title>
        <mat-divider></mat-divider>
        <mat-list>
          <mat-list-item *ngFor="let c of cursosDisponiveis">
            <mat-icon matListItemIcon>school</mat-icon>
            <div matListItemTitle>{{ c.titulo }}</div>
            <div matListItemLine class="muted">{{ c.categoria }}</div>
            <button mat-raised-button color="primary" (click)="iniciarCurso(c)">Iniciar</button>
          </mat-list-item>
        </mat-list>
      </mat-card>
    </section>

    <section class="grid bottom-grid">
      <mat-card class="card">
        <mat-card-title>Ranking do Departamento</mat-card-title>
        <mat-divider></mat-divider>
        <mat-list>
          <mat-list-item *ngFor="let r of ranking; let i = index">
            <div matListItemIcon class="rank-badge">{{ i + 1 }}</div>
            <div matListItemTitle>{{ r.nome }}</div>
            <div matListItemLine class="muted">{{ r.cargo }}</div>
            <div class="xp">{{ r.xp | number }} XP</div>
          </mat-list-item>
        </mat-list>
      </mat-card>

      <mat-card class="card">
        <mat-card-title>Últimas atividades</mat-card-title>
        <mat-divider></mat-divider>
        <mat-list>
          <mat-list-item *ngFor="let a of atividades">
            <mat-icon matListItemIcon>{{ a.icone }}</mat-icon>
            <div matListItemTitle>{{ a.titulo }}</div>
            <div matListItemLine class="muted">{{ a.data | date:'short' }}</div>
            <div class="xp" *ngIf="a.xpDelta !== 0">
              <mat-chip [color]="a.xpDelta >= 0 ? 'primary' : ''"
                        [class.selected-chip]="a.xpDelta >= 0">
                {{ a.xpDelta >= 0 ? '+' : ''}}{{ a.xpDelta }} XP
              </mat-chip>
            </div>
          </mat-list-item>
        </mat-list>
      </mat-card>
    </section>
  </div>
</div>