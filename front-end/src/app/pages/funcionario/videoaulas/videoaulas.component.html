<div class="player-container" *ngIf="curso && aulaAtual">
  
  <div class="course-header">
    <h1 class="titulo-principal">{{ curso.titulo }}</h1>
    <div class="xp-badge" *ngIf="curso.xpConclusao">
      <mat-icon>bolt</mat-icon>
      <span>+{{ curso.xpConclusao }} XP ao concluir</span>
    </div>
  </div>

  <div class="content-grid">

    <main class="video-section">
      <div class="video-wrapper">
        <iframe 
            [src]="urlVideoSegura" 
            title="YouTube video player" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
            allowfullscreen>
        </iframe>
      </div>

      <div class="aula-info">
        <h2 class="aula-titulo">{{ aulaAtual.titulo }}</h2>
        
        <div class="aula-actions">
           <!-- Botão de Concluir com lógica de estado e evento de click -->
           <button mat-stroked-button 
                   color="primary" 
                   (click)="concluirAula()"
                   [disabled]="isAulaConcluida(aulaAtual)">
             <mat-icon>{{ isAulaConcluida(aulaAtual) ? 'check_circle' : 'check_circle_outline' }}</mat-icon>
             {{ isAulaConcluida(aulaAtual) ? 'Concluída' : 'Marcar como concluída' }}
           </button>

           <!-- Botão de Próxima Aula com evento de click -->
           <button mat-button class="btn-next" (click)="irParaProximaAula()">
             Próxima aula
             <mat-icon>skip_next</mat-icon>
           </button>
        </div>
      </div>
    </main>

    <aside class="playlist-sidebar">
      <h3 class="sidebar-title">Conteúdo do Curso</h3>
      
      <mat-accordion multi="true">
        <mat-expansion-panel *ngFor="let modulo of curso.modulos; let i = index" [expanded]="i === 0" class="modulo-panel">
          
          <mat-expansion-panel-header class="modulo-header">
            <div class="header-content">
              <div class="header-top">
                <span class="modulo-label">Módulo {{ modulo.ordem }}</span>
                <span class="aula-count">{{ modulo.aulas.length }} aulas</span>
              </div>
              <span class="modulo-titulo">{{ modulo.titulo }}</span>
            </div>
          </mat-expansion-panel-header>
          
          <mat-nav-list class="aulas-list">
            <a mat-list-item 
               *ngFor="let aula of modulo.aulas" 
               (click)="selecionarAula(aula)"
               [class.active-aula]="aula.id === aulaAtual.id"
               class="aula-item">
              
              <!-- Ícone dinâmico: Check se concluída, Play se atual/pendente -->
              <mat-icon matListItemIcon>
                {{ isAulaConcluida(aula) ? 'check_circle' : (aula.id === aulaAtual.id ? 'play_circle_filled' : 'play_circle_outline') }}
              </mat-icon>
              
              <span matListItemTitle>{{ aula.titulo }}</span>
            </a>
          </mat-nav-list>

        </mat-expansion-panel>
      </mat-accordion>

    </aside>

  </div>
</div>